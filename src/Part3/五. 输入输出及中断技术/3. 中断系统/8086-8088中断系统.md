# 8086/8088中断系统

## 8086/8088中断源

* 256个中断源
  * 内部中断
    * 软件中断
    * 除法错中断
    * 溢出中断
    * 单步中断
    * ...
  * 外部中断
    * 非屏蔽中断 NMI
    * 可屏蔽中断 INTR

### 每个中断源分配了的中断类型号

![每个中断源分配了的中断类型号](pics/%E6%AF%8F%E4%B8%AA%E4%B8%AD%E6%96%AD%E6%BA%90%E5%88%86%E9%85%8D%E4%BA%86%E7%9A%84%E4%B8%AD%E6%96%AD%E7%B1%BB%E5%9E%8B%E5%8F%B7.png)

> 一片8259最多处理8个中断源(只有8个引脚)
>
> 可用多8259级联的方式进行扩展(第一个8259的一个引脚接另一个8259), 两片级联的方式可以扩展到15个(第一级7个+第二级8个), 此时的对应类型号画在图中

## 8086/8088中断向量表

各中断源的服务程序入口地址按顺序存放在中断向量表

中断向量表位于内存最低1KB

地址范围: `00000H～003FFH`

![中断向量表](pics/%E4%B8%AD%E6%96%AD%E5%90%91%E9%87%8F%E8%A1%A8.png)

> 注意先存IP  
> 向量表入口地址计算: n * 4 (n为中断类型号)

### 中断向量表初始化

将用户自定义的中断服务程序入口地址放入中断向量表

向量表所在的`段基址 = 0`

存放子程序入口的单元的`偏移地址 = n * 4` (n为中断类型号)

#### 中断向量表初始化示例

将类型码为48H的中断服务子程序`TIMER`的中断向量用`MOV`指令写入中断向量表

```asm
MOV AX, 0
MOV DS, AX              ;数据段段基址
MOV SI, 0120H           ;向量地址48H*4
MOV BX, OFFSET TIMER    ;子程序入口偏移地址
MOV [SI],BX
MOV BX,SEG TIMER        ;子程序入口段基址
MOV [SI+2], BX
```

> 注意先送偏移地址

## 8086/8088中断响应过程

### 可屏蔽外部中断(INTR)处理过程

![可屏蔽外部中断(INTR)处理过程](pics/%E5%8F%AF%E5%B1%8F%E8%94%BD%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD(INTR)%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B.png)

> 注意由软件实现就说明要在自己的中断服务程序里面执行, 此时以及进到服务程序

### 可屏蔽外部中断(INTR)响应过程

![可屏蔽外部中断(INTR)响应过程](pics/%E5%8F%AF%E5%B1%8F%E8%94%BD%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD(INTR)%E5%93%8D%E5%BA%94%E8%BF%87%E7%A8%8B.png)

> 第一次发送$\overline{INTA}$指示8259设置各寄存器, 但中断类型码在第二个INTA周期才获取到

获取中断类型号n $\rightarrow$ 计算向量地址：n x 4 $\rightarrow$ 清除IF、TF $\rightarrow$ 保护硬件现场(FLAGS) $\rightarrow$ 保存断点(CS、IP) $\rightarrow$ 中断服务程序入口地址送CS、IP $\rightarrow$ 转中断服务程序


### 内部中断和非屏蔽中断响应过程

类型号CPU自动形成，<font color="red">不需$\overline{INTA}$ ̅总线周期</font>

计算向量地址：nx4 $\rightarrow$ 清除IF、TF $\rightarrow$ 保护硬件现场(FLAGS) $\rightarrow$ 保存断点(IP、CS) $\rightarrow$ 中断服务程序入口地址送CS、IP $\rightarrow$ 转中断服务程序

### 8086的中断响应和处理流程

![中断响应与处理流程](pics/%E4%B8%AD%E6%96%AD%E5%93%8D%E5%BA%94%E4%B8%8E%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.png)

> 注意 TF=1 (单步中断)
