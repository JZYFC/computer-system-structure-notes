# 主存储器的逻辑设计

主要问题：

* 单个存储芯片可能不满足主存容量需求，则需要多个存储芯片构成主存储器  
* <font color="orange">逻辑设计</font>，即如何分配地址码，用于<font color="blue">选择芯片（片选逻辑）与片内单元（地址分配）</font>  
* 主存如何与CPU<font color="orange">连接</font>  

## 1. 设计主存时, 主要考虑的问题

1. 需要先明确<font color=orange>总容量</font>: 字数(单元数) $\times$ 位数
2. 确定可用选用的<font color=orange>存储芯片</font>: 类型、型号、每片容量

可能存在<font color=orange>位数</font>和<font color="orange">字数</font>的<font color="orange">扩展问题</font>

1. 位扩展  
    各芯片的数据线相拼接, 满足位数要求
2. 字扩展  
    若干芯片组成连续地址空间的存储器, 满足字数要求

## 2. 主存逻辑设计示例

### 例1

![例1](pics/%E8%AE%BE%E8%AE%A1%E7%A4%BA%E4%BE%8B1.png)

#### (1) 计算芯片数

![计算芯片数](pics/1-%E8%AE%A1%E7%AE%97%E8%8A%AF%E7%89%87%E6%95%B0.png)

#### (2) 地址分配与片选逻辑

![地址分配与片选逻辑](pics/1-%E5%9C%B0%E5%9D%80%E5%88%86%E9%85%8D%E4%B8%8E%E7%89%87%E9%80%89%E9%80%BB%E8%BE%91.png)

#### (3) 连接方式

![连接方式](pics/1-%E8%BF%9E%E6%8E%A5%E6%96%B9%E5%BC%8F.png)

纵向位扩展, 横向字扩展  
注意箭头方向(双向可读可写)  
注意芯片的CS低电位有效, 于是用了与非门  
注意片选信号(四个CS)只有一个有效
> 如 ?00H 选中最左边两片

### 例2

![设计示例2](pics/%E8%AE%BE%E8%AE%A1%E7%A4%BA%E4%BE%8B2.png)

#### (1) 计算容量和芯片数

![计算容量和芯片数](pics/2-%E8%AE%A1%E7%AE%97%E8%8A%AF%E7%89%87%E6%95%B0.png)

#### (2) 地址分配与片选逻辑

存储空间分配: 先安排大容量芯片(放地址低端), 再安排小容量芯片

![地址分配与片选逻辑](pics/2-%E5%9C%B0%E5%9D%80%E5%88%86%E9%85%8D%E4%B8%8E%E7%89%87%E9%80%89%E9%80%BB%E8%BE%91.png)
注意1K芯片的片选逻辑

#### (3) 连接方式

![连接方式](pics/2-%E8%BF%9E%E6%8E%A5%E6%96%B9%E5%BC%8F.png)

注意ROM只读, 箭头单向, 注意与RAM的区别  
与非门逻辑功能同或门

## 3. 片选地址译码

将高位地址信号通过一组电路转换为一个确定的输出信号(高/低电平)，并将该输出连接到存储芯片的片选端(一般用$\overline{CS}$)，选中该芯片

译码电路实现: <font color=blue>基本逻辑门、译码器</font>

[译码器](../../../../Part1/%E4%BA%8C.%20%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91%E5%9F%BA%E7%A1%80.md)
![译码器1](pics/%E8%AF%91%E7%A0%81%E5%99%A81.png)
![译码器2](pics/%E8%AF%91%E7%A0%81%E5%99%A82.png)

### 片选地址译码方式

#### 1. 全地址译码方式

全部地址信号都使用，<font color="blue">高位地址</font>信号用作译码器的输入，<font color="blue">低位地址</font>信号接存储芯片的地址输入线

#### 2. 部分地址译码方式

仅用地址总线的<font color="blue">一部分信号线</font>与存储器连接：通常是用高位地址信号的<font color="blue">一部分</font>作为片选译码信号(其他信号不定, 会造成地址空间的覆盖)；低位地址信号接存储芯片的地址输入线

* 特例: 线译码: 只有2个(组)芯片

![译码方式示例](pics/%E8%AF%91%E7%A0%81%E6%96%B9%E5%BC%8F%E7%A4%BA%E4%BE%8B.png)

### 示例

#### 全地址译码示例

##### 例1

![1](pics/%E5%85%A8%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-1.png)
![2](pics/%E5%85%A8%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-2.png)
![3](pics/%E5%85%A8%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-3.png)
![4](pics/%E5%85%A8%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-4.png)

##### 例2

![1](pics/%E5%85%A8%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B2-1.png)
![2](pics/%E5%85%A8%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B2-2.png)
![3](pics/%E5%85%A8%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B2-3.png)
![4](pics/%E5%85%A8%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B2-4.png)
这有张图炸了, windows补上  
2天过去了, 什么都没有

**明天考试了，什么都没有**

![6](pics/%E5%85%A8%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B2-6.png)

#### 部分地址译码示例

##### 例3

![1](pics/%E9%83%A8%E5%88%86%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-1.png)

![2](pics/%E9%83%A8%E5%88%86%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-2.png)

![3](pics/%E9%83%A8%E5%88%86%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-3.png)

共4组, 故A13固定为0
![4](pics/%E9%83%A8%E5%88%86%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-4.png)

![5](pics/%E9%83%A8%E5%88%86%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-5.png)

![6](pics/%E9%83%A8%E5%88%86%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-6.png)

![7](pics/%E9%83%A8%E5%88%86%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-7.png)

这又有张图炸了  

![9](pics/%E9%83%A8%E5%88%86%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B1-9.png)

##### 例4

![2](pics/%E9%83%A8%E5%88%86%E5%9C%B0%E5%9D%80%E8%AF%91%E7%A0%81%E7%A4%BA%E4%BE%8B2.png)

### 全地址、部分地址译码的特点

#### 部分地址译码

##### 优点

译码电路构成简单, 成本低

##### 缺点

地址出现重叠区(同一个物理存储器映射到了不同的地址), 破坏了地址空间的连续性, 减少了总的可用的存储地址空间

#### 全地址译码

##### 优点

存储器每一个单元在整个内存空间中具有唯一的地址, 充分利用存储空间

##### 缺点

译码电路复杂

### 例5

![1](pics/%E4%BE%8B5-1.png)

![2](pics/%E4%BE%8B5-2.png)

![3](pics/%E4%BE%8B5-3.png)

注意片内容量不同导致的片内地址不同

注意A11在与门上的连接: 因为最后一个存储单元只有2K, 对比前面的4K, 选中最后一片时必须保证A11为0

通常做法为中间加上一块芯片加判断(如图中的与门), 如果不处理, 会有地址重叠问题的存在
